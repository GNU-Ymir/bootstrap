mod ymirc::semantic::optimizer::visitor;

import std::collection::map;
import std::collection::vec;
import std::io;

import ymirc::utils::format;
import ymirc::semantic::generator::_;

/**
 * The optimizer class simplifies previously validated symbols
 */
pub class Optimizer {

    // The list of generators provided by the previous pass (validation)
    let mut _generators : [&Generator] = [];

    // The list of optimized frames (for inlining)
    let dmut _frames : &HashMap!{[c8], &Generator} = HashMap!{[c8], &Generator}::new ();

    // The list of optimized generators
    let dmut _optimized = Vec!{&Generator}::new ();

    // Mangler used to generate uniq names
    let _mangler = Mangler::new ();

    /**
     * Create a new empty optimizer
     * */
    pub self () {}

    /**
     * Optimize a list of generators
     * */
    pub fn optimize (mut self, generators : [&Generator])-> [&Generator] {
        self._generators = generators;
        for gen in self._generators {
            self:.optimize (gen);
        }

        self._optimized[]
    }

    /**
     * Optimize a generator
     * */
    pub fn optimize (mut self, gen : &Generator) {
        match gen {
            frame : &FrameGenerator => {
                self:.optimizeFrame (frame);
            }
            _ => {
                self._optimized:.push (gen);
            }
        }
    }

    /**
     * Optimize a frame generator
     * @params:
     *    - frame: the frame to optimize
     * */
    pub fn optimizeFrame (mut self, frame : &FrameGenerator) {
        self._optimized:.push (frame);
    }


}
